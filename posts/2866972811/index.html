<!DOCTYPE html>
<html lang="zh" dir="ltr">
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<meta content="yes" name="apple-mobile-web-app-capable">
<meta content="black-translucent" name="apple-mobile-web-app-status-bar-style">
<meta content="telephone=no" name="format-detection">
<meta content="真就以折腾自己为乐。 TAGS: archlinux, 系统迁移, debian, btrfs, 系统备份" name="description">
<meta content="archlinux, 系统迁移, debian, btrfs, 系统备份" name="keywords" >
<meta content="记一次失败的从 Arch Linux 迁移到 Debian Sid 的经历 | weearc 的个人博客" name="title">

<title>记一次失败的从 Arch Linux 迁移到 Debian Sid 的经历 | weearc 的个人博客</title>

<script src="https://blog.weearc.top/js/lib/jquery-3.7.1.min.js"></script>


<script src="https://blog.weearc.top/js/lib/fuse.js"></script>


<link href="https://blog.weearc.top/css/lib/pure-min.css" rel="stylesheet">


    <link href="https://blog.weearc.top/css/lib/grids-responsive-min.css" rel="stylesheet">


<link href="https://blog.weearc.top/css/lib/font-awesome.min.css" rel="stylesheet">



  <link rel="stylesheet" href="https://blog.weearc.top/css/main.a46c1f3ae4f27e620bfa7ed2e7cd2b001a8b52ee8a9178a9cc8bfba03f934b54.css" integrity="sha256-pGwfOuTyfmIL&#43;n7S580rABqLUu6KkXipzIv7oD&#43;TS1Q=" crossorigin="anonymous">




      <script src="/js/main.1de2e63b2f316e087a071ebe652e354054e2d100b986d2002f27cccfd8a24ff0.js" integrity="sha256-HeLmOy8xbgh6Bx6&#43;ZS41QFTi0QC5htIALyfMz9iiT/A=" crossorigin="anonymous"></script>




</head>

<script async src="//www.googletagmanager.com/gtag/js?id=G-NV3NVYB38C"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-NV3NVYB38C');
</script>
<body>
  <div class="body__container">
    <div id="header">
      <div class="site__name" >
    <a id="logo" href="/.">weearc 的个人博客</a>
    <p class="description">想离相惜莫相忘，且行且歌且珍惜</p>
</div>
<div id="nav-menu">
    
    
    
        <a href="https://blog.weearc.top/" title="首页">
           <i class="fa fa-home">首页</i>
        </a>
        <a href="https://blog.weearc.top/archives/" title="归档">
           <i class="fa fa-archive">归档</i>
        </a>
        <a href="https://blog.weearc.top/frlink/" title="友链">
           <i class="fa fa-link">友链</i>
        </a>
        <a href="https://blog.weearc.top/about/" title="关于">
           <i class="fa fa-user">关于</i>
        </a>
        <a href="https://blog.weearc.top/index.xml" title="订阅">
           <i class="fa fa-rss">订阅</i>
        </a>
</div>


    </div>
    <div class="pure-g" id="layout">
      <div class="pure-u-1  pure-u-md-3-4 ">
        <div class="content__container">
          
  <div class="post">
    <h1 class="post-title">记一次失败的从 Arch Linux 迁移到 Debian Sid 的经历</h1>
    
    <div class="post-meta">
      
      
      
      <span datetime="2023-09-25T00:00:00&#43;00:00">Sep. 25, 2023</span>
      <span class="post-time">
        <span class="post-meta-item-text"> | </span>
        <span class="post-meta-item-icon">
          <i class="fa fa-keyboard-o"></i>
          <span class="post-count">4280</span>
          <span class="post-meta-item-text"> 字</span>
        </span>
      </span>
    </div>
    
    
    <a class="disqus-comment-count" href="./#vcomments">
      <span class="valine-comment-count" data-xid="/posts/2866972811/"></span>
      <span> 条评论</span>
    </a>
    
    
    <div class="clear">
      
        <div class="toc-article" id="toc">
          <div class="toc-title">文章目录</div>
          <nav id="TableOfContents">
  <ul>
    <li><a href="#起因">起因</a></li>
    <li><a href="#arch-linux---debian">Arch Linux -&gt; Debian</a>
      <ul>
        <li><a href="#开始给自己找麻烦">开始给自己找麻烦</a></li>
        <li><a href="#麻烦开始自己找上门">麻烦开始自己找上门</a></li>
        <li><a href="#更加麻烦起来了">更加麻烦起来了</a></li>
      </ul>
    </li>
    <li><a href="#debian---arch-linux">Debian -&gt; Arch LInux</a></li>
    <li><a href="#总结">总结</a></li>
  </ul>
</nav>
        </div>
      
    </div>
    
    <div class="post-content">
      <p>真就以折腾自己为乐。</p>
<p>其实我从来没想好自己应该使用什么发行版，十多年前最开始使用 Arch Linux 也只是因为觉得大家都在使用 什么 Ubuntu 啊觉得自己可以特例独行一些，并没有深刻的体会到什么叫做 KISS，也没有体会到各种拆包粒度对于使用的影响，也一直只是“会用”而已，并没有太多作为用户之外的使用体验差距。就算是第二个使用的发行版是 openSUSE 也一样，因为某种程度上有类似的基因。</p>
<h2 id="起因">起因</h2>
<p>闲的蛋痛。年初企图迁移到 Fedora 失败，仅仅过了5个小时就滚回了 Arch 。可能考虑到了 Debian Sid 的如下特性，打算这次外迁一定要迁移出去，去 Debian。</p>
<ul>
<li>足够稳定</li>
<li>apt 的前端 nala，看上去很帅</li>
<li>周围用 Arch 的很多，向特立独行一点</li>
<li>复习时间之余闲的蛋痛</li>
</ul>
<p>但是也考虑到一些区别，比如：</p>
<ul>
<li>包管理器的整合性：debian 系素以混乱的包管理功能著称，dpkg、apt、apt-get、apt-file</li>
<li>软件包获取的难度：这也是为什么我一直非常抗拒使用 deb 系，你可以在软件官网上（比如 zotero），在 github release，在 makedeb ，在 pacstall，在 ppa&hellip;你能找出一百个不同的软件包来源，但是你没办法把他们整合（Debian CN repo 许久未变更了）</li>
<li>不知道的一些奇奇怪怪的特性</li>
<li>wiki，debian wiki 也就将将是能参考的程度</li>
</ul>
<p>以上这些问题并没罗列全面，但是我曾经认为自己能够克服这些问题。虽然显然还是太高看自己了。</p>
<h2 id="arch-linux---debian">Arch Linux -&gt; Debian</h2>
<p>安装一个新的发行版是容易的，也没什么好说。但是考虑到年初 fedora 的惨痛经历，我打算还是给自己留个后路，方法可以有很多，rsync、或者整体dd、或者打个 tarball 什么的，之前有过尝试用 squashfs 备份系统的经验，而且打包后镜像体积特别小，也是很多发行版安装 CD 的首选方案。那就决定了。</p>
<p>首先备份根分区，需要排除掉所有额外挂载的分区和运行态的玩意儿：</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo mksquashfs / backup-archlinux.squashfs -e /home -e /run -e /proc -e /dev -e /sys -e /tmp -e /var/tmp -e /mnt /boot/efi
</span></span></code></pre></td></tr></table>
</div>
</div><p>直接把镜像扔到了外挂的 SSD 上面，体积也不大，150 G 根分区体积也就 27 G。然后下载了 Debian stable bookworm 的镜像，写盘，分区，安装&hellip;不一而足。</p>
<p>装上 Debian 的第一件事就是把 nala 装上，apt 那个简陋的信息展示还是非常难受的，好在 Buster 以后已经默认在 main 里了。</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo apt install nala -y
</span></span></code></pre></td></tr></table>
</div>
</div><p>然后发现自己不在 sudoers 里，得把自己手工添加进去：</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>su - -c <span style="color:#b44">&#34;usermod -a -G sudo `whoami`&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>注销，重新登陆，sudo 可以正常使用了。</p>
<p>接下来切换到 sid，直接编辑 <code>/etc/apt/sources.list</code> 内容如下：</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>deb https://mirrors.cqu.edu.cn/debian sid main contrib non-free non-free-firmware
</span></span><span style="display:flex;"><span># deb-src http://mirrors.cqu.edu.cn/debian sid main contrib non-free non-free-firmware
</span></span></code></pre></td></tr></table>
</div>
</div><p>直接执行更新：</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo nala update <span style="color:#666">&amp;&amp;</span> sudo nala upgrade -y
</span></span></code></pre></td></tr></table>
</div>
</div><p>重启后切换为了 sid ，plasma 也更新到了 5.27.8。这时候给了我第一个下马威：<code>/sbin/</code> 没 merge 到 <code>/usr/bin</code> ，问题不大，改个 <code>/etc/profile</code> 加个 PATH 的事。然后安装软件云云，不一而足。</p>
<h3 id="开始给自己找麻烦">开始给自己找麻烦</h3>
<p>从 QQ 开始，这时候我想到一个问题，我在 Arch 下可是用的 AUR 上魔改的 launcher 的启动脚本，要是 deb 每次装完都覆盖掉还是有点难受的。在 Arch 上我习惯于用 pacman hook 处理类似问题，但是 dpkg 好像没有 hook 可用。但是 stackexchange 上的<a href="https://unix.stackexchange.com/questions/492697/cleaner-way-to-detect-if-a-particular-package-was-installed-in-apt-get-hook">某篇帖子</a>和我的需求是一致的，都是需要更新后然后监听特定文件，并 patch 。那显然回答中的 file trigger 是一个可以使用的东西，那么需求明确了：</p>
<ol>
<li>创建一个带触发器的空包</li>
<li>空包中携带对于需要 patch 部分的脚本或源文件</li>
<li>安装触发器包后安装原 deb 包触发触发器</li>
<li>patched</li>
</ol>
<p>之前曾经在 Arch 上给 deb 系打过 deb 包，所以创建包过程算是轻车熟路，只不过需要添加 <code>DEBIAN/trigger</code> 和 <code>DEBIAN/postinst</code> ， trigger 中 <code>interest &lt;path/to/file&gt;</code> ，然后 postinst 脚本书写如下：</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#080">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#080"></span><span style="color:#a2f;font-weight:bold">if</span> <span style="color:#666">[</span> <span style="color:#b44">&#34;</span><span style="color:#b8860b">$1</span><span style="color:#b44">&#34;</span> <span style="color:#666">=</span> <span style="color:#b44">&#34;triggered&#34;</span> <span style="color:#666">]</span>
</span></span><span style="display:flex;"><span><span style="color:#a2f;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a2f;font-weight:bold">if</span> <span style="color:#666">[</span> <span style="color:#b44">&#34;</span><span style="color:#b8860b">$2</span><span style="color:#b44">&#34;</span> <span style="color:#666">=</span> <span style="color:#b44">&#34;&lt;path/to/file/triggered&gt;&#34;</span> <span style="color:#666">]</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a2f;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#080;font-style:italic"># do some patches</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a2f;font-weight:bold">fi</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a2f">exit</span> <span style="color:#666">0</span>
</span></span><span style="display:flex;"><span><span style="color:#a2f;font-weight:bold">fi</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>dpkg 在拦截监听器之后在入参上第一个参数是包状态，如果包被其他监听器“感兴趣”，那么第一个参数固定为 <code>triggered</code> ，第二个参数为监听的具体文件。这里需要注意的是，有些包会在后处理部分处理启动器文件等，而我们需要 patch 的部分也是这部分，就需要具体监听其他具体文件。另外所有打包脚本都需要空一行作为 EOF ，否则打包时必报错。</p>
<blockquote>
<p>因为特殊需要并没有增长，所以目前仅仅放了一部分 patch 在<a href="https://github.com/weearc/debian-custom-trigger">仓库</a>中。很遗憾没法继续维护下去，以后大概也不会主动去维护。</p>
</blockquote>
<h3 id="麻烦开始自己找上门">麻烦开始自己找上门</h3>
<p>主要缘由在于我需要一个 Minecraft Launcher。而我常用的是 prismlauncher，但是！没有 deb 包。在 Arch 上没什么好说的，使用的甚至是 <code>-git</code> 版本不说而且是 Qt6 的包。以前打 Qt 包的经历自不必说，经常需要手动打包这样的项目还是非常难受的（难受在 debian 上 qt6 依赖并不全，或者可能拆包太细了我找不到）。前面提到了有 makedeb 这样的平台提供类似 PKGBUILD 的打包脚本并且有托管仓库，而里面，只有 stable 版本。但是毕竟本着能用就行要求不高的原则，先装上用一下。连着 jdk 装好后还姑且启动了几次 MC 1.16.5 试了一下看上去并没有大问题。</p>
<p>接下来开始找 neovim，然后&hellip;源的版本是 0.7.2，我的配置文件是 0.9.2 的&hellip;不兼容不说，迁移过去也非常麻烦，这些配置文件是长年累月积攒下来的，迁移也是个大工程。那没办法，姑且用官方 binary 包用一下。能用就行。但是 vim&hellip;可就太麻烦了，我需要的包括 clipboard 的编译选项 debian 的几个 vim 包都是默认不开的。但是要是使用 vim-nox 的话又不完全支持我在用的插件。那只能先用 vim-common 凑合下了。然后，我 zotero 呢？plasma 5.27.8 不应该存在的 bug （夜览相关的） 怎么还有呢？我 grub-btrfs 呢？我 mmc 呢？我 freetype2 怎么这么多不相关的依赖它的呢？说好的拆包细呢？<code>/usr/game</code> 是什么上古遗留？我 <code>usr-merge</code>呢？有一种，自己的偏见问题主动离开亲妈去找后妈，结果后妈问题更多的即视感。</p>
<p>想着先把那些放一放，咱们先把 Nvidia Optimus Sync 和显卡直出配了，然后查了一下 wiki , 被告知应当使用 <code>nvidia-detect</code> 检测脚本决定用什么驱动包。然后，该脚本检测到我的是 30 系移动端卡之后，自己退出了&hellip;好嘛，凭借在 Arch 上的经验，咱们先把开源驱动干掉，blacklist 之，然后装 <code>nvidia-drivers</code> 大概就没什么问题了。然后问题就来了，Debian Wiki 上给的 Optimus Sync 的 X11 配置文件样例，根本就不是做 Optimus Sync 的。那就还是参考一下 <a href="https://wiki.archlinux.org/title/NVIDIA_Optimus#Use_NVIDIA_graphics_only">Arch Linux Wiki</a> 姑且配一下:</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># /etc/X11/xorg.conf.d/10-nvidia-drm-outputclass.conf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Section &#34;OutputClass&#34;
</span></span><span style="display:flex;"><span>    Identifier &#34;intel&#34;
</span></span><span style="display:flex;"><span>    MatchDriver &#34;i915&#34;
</span></span><span style="display:flex;"><span>    Driver &#34;modesetting&#34;
</span></span><span style="display:flex;"><span>EndSection
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Section &#34;OutputClass&#34;
</span></span><span style="display:flex;"><span>    Identifier &#34;nvidia&#34;
</span></span><span style="display:flex;"><span>    MatchDriver &#34;nvidia-drm&#34;
</span></span><span style="display:flex;"><span>    Driver &#34;nvidia&#34;
</span></span><span style="display:flex;"><span>    Option &#34;AllowEmptyInitialConfiguration&#34;
</span></span><span style="display:flex;"><span>    Option &#34;PrimaryGPU&#34; &#34;yes&#34;
</span></span><span style="display:flex;"><span>    ModulePath &#34;/usr/lib/nvidia/xorg&#34;
</span></span><span style="display:flex;"><span>    ModulePath &#34;/usr/lib/xorg/modules&#34;
</span></span><span style="display:flex;"><span>EndSection
</span></span></code></pre></td></tr></table>
</div>
</div><p>但是，Debian 的 ModulePath 位置并不一致，需要找一下。不过问题也不大，总归<code>dpkg -L</code> 也能找到。但是问题就来了，nvidia-fbc 并没有随 nvidia-drivers 一起安装，nvenc 也并没法启用。但是总归是拆包的问题装上去就没问题了，大概。</p>
<h3 id="更加麻烦起来了">更加麻烦起来了</h3>
<p>总体来说，虽然我的需求奇奇怪怪但是 Debian 大体上能满足，我也不多说什么。直到和群友聊起来，Minecraft 的 In-Game 打开文件夹没法打开。然后我试了一下，确实打不开。虽然资源包什么的我日常很少动，但是总归打不开还是很麻烦，明明我在 Arch 上都是行为正常的&hellip;. 打印了一下日志，发现如下问题:</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>java.<span style="color:#b44">security</span>.<span style="color:#b44">PrivilegedActionException</span>:<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">null</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>at<span style="color:#bbb"> </span>java.<span style="color:#b44">security</span>.<span style="color:#b44">AccessController</span>.<span style="color:#b44">doPrivileged</span>(AccessController.<span style="color:#b44">java</span>:573)<span style="color:#bbb"> </span><span style="color:#666">~[?</span>:<span style="color:#666">?]</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>at<span style="color:#bbb"> </span>net.<span style="color:#b44">minecraft</span>.<span style="color:#b44">class_156$class_158</span>.<span style="color:#b44">method_669</span>(class_156.<span style="color:#b44">java</span>:313)<span style="color:#bbb"> </span><span style="color:#666">~[</span>client<span style="color:#666">-</span>intermediary.<span style="color:#b44">jar</span>:<span style="color:#666">?]</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>at<span style="color:#bbb"> </span>net.<span style="color:#b44">minecraft</span>.<span style="color:#b44">class_156$class_158</span>.<span style="color:#b44">method_673</span>(class_156.<span style="color:#b44">java</span>:324)<span style="color:#bbb"> </span><span style="color:#666">~[</span>client<span style="color:#666">-</span>intermediary.<span style="color:#b44">jar</span>:<span style="color:#666">?]</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>at<span style="color:#bbb"> </span>net.<span style="color:#b44">minecraft</span>.<span style="color:#b44">class_5375</span>.<span style="color:#b44">method_29670</span>(class_5375.<span style="color:#b44">java</span>:102)<span style="color:#bbb"> </span><span style="color:#666">~[</span>client<span style="color:#666">-</span>intermediary.<span style="color:#b44">jar</span>:<span style="color:#666">?]</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>at<span style="color:#bbb"> </span>net.<span style="color:#b44">minecraft</span>.<span style="color:#b44">class_4185</span>.<span style="color:#b44">method_25306</span>(class_4185.<span style="color:#b44">java</span>:94)<span style="color:#bbb"> </span><span style="color:#666">~[</span>client<span style="color:#666">-</span>intermediary.<span style="color:#b44">jar</span>:<span style="color:#666">?]</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>at<span style="color:#bbb"> </span>net.<span style="color:#b44">minecraft</span>.<span style="color:#b44">class_4264</span>.<span style="color:#b44">method_25348</span>(class_4264.<span style="color:#b44">java</span>:56)<span style="color:#bbb"> </span><span style="color:#666">~[</span>client<span style="color:#666">-</span>intermediary.<span style="color:#b44">jar</span>:<span style="color:#666">?]</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>at<span style="color:#bbb"> </span>net.<span style="color:#b44">minecraft</span>.<span style="color:#b44">class_339</span>.<span style="color:#b44">method_25402</span>(class_339.<span style="color:#b44">java</span>:189)<span style="color:#bbb"> </span><span style="color:#666">~[</span>client<span style="color:#666">-</span>intermediary.<span style="color:#b44">jar</span>:<span style="color:#666">?]</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>at<span style="color:#bbb"> </span>net.<span style="color:#b44">minecraft</span>.<span style="color:#b44">class_4069</span>.<span style="color:#b44">method_25402</span>(class_4069.<span style="color:#b44">java</span>:38)<span style="color:#bbb"> </span><span style="color:#666">~[</span>client<span style="color:#666">-</span>intermediary.<span style="color:#b44">jar</span>:<span style="color:#666">?]</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>at<span style="color:#bbb"> </span>net.<span style="color:#b44">minecraft</span>.<span style="color:#b44">class_312</span>.<span style="color:#b44">method_1611</span>(class_312.<span style="color:#b44">java</span>:98)<span style="color:#bbb"> </span><span style="color:#666">~[</span>client<span style="color:#666">-</span>intermediary.<span style="color:#b44">jar</span>:<span style="color:#666">?]</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>at<span style="color:#bbb"> </span>net.<span style="color:#b44">minecraft</span>.<span style="color:#b44">class_437</span>.<span style="color:#b44">method_25412</span>(class_437.<span style="color:#b44">java</span>:409)<span style="color:#bbb"> </span><span style="color:#666">~[</span>client<span style="color:#666">-</span>intermediary.<span style="color:#b44">jar</span>:<span style="color:#666">?]</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>at<span style="color:#bbb"> </span>net.<span style="color:#b44">minecraft</span>.<span style="color:#b44">class_312</span>.<span style="color:#b44">method_1601</span>(class_312.<span style="color:#b44">java</span>:98)<span style="color:#bbb"> </span><span style="color:#666">~[</span>client<span style="color:#666">-</span>intermediary.<span style="color:#b44">jar</span>:<span style="color:#666">?]</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>at<span style="color:#bbb"> </span>net.<span style="color:#b44">minecraft</span>.<span style="color:#b44">class_312</span>.<span style="color:#b44">method_22686</span>(class_312.<span style="color:#b44">java</span>:169)<span style="color:#bbb"> </span><span style="color:#666">~[</span>client<span style="color:#666">-</span>intermediary.<span style="color:#b44">jar</span>:<span style="color:#666">?]</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>at<span style="color:#bbb"> </span>net.<span style="color:#b44">minecraft</span>.<span style="color:#b44">class_1255</span>.<span style="color:#b44">execute</span>(class_1255.<span style="color:#b44">java</span>:102)<span style="color:#bbb"> </span><span style="color:#666">~[</span>client<span style="color:#666">-</span>intermediary.<span style="color:#b44">jar</span>:<span style="color:#666">?]</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>at<span style="color:#bbb"> </span>net.<span style="color:#b44">minecraft</span>.<span style="color:#b44">class_312</span>.<span style="color:#b44">redirect$foc001$viafabricplus$redirectSync</span>(class_312.<span style="color:#b44">java</span>:3538)<span style="color:#bbb"> </span><span style="color:#666">~[</span>client<span style="color:#666">-</span>intermediary.<span style="color:#b44">jar</span>:<span style="color:#666">?]</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>at<span style="color:#bbb"> </span>net.<span style="color:#b44">minecraft</span>.<span style="color:#b44">class_312</span>.<span style="color:#b44">method_22684</span>(class_312.<span style="color:#b44">java</span>:169)<span style="color:#bbb"> </span><span style="color:#666">~[</span>client<span style="color:#666">-</span>intermediary.<span style="color:#b44">jar</span>:<span style="color:#666">?]</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>at<span style="color:#bbb"> </span>org.<span style="color:#b44">lwjgl</span>.<span style="color:#b44">glfw</span>.<span style="color:#b44">GLFWMouseButtonCallbackI</span>.<span style="color:#b44">callback</span>(GLFWMouseButtonCallbackI.<span style="color:#b44">java</span>:43)<span style="color:#bbb"> </span><span style="color:#666">~[</span>lwjgl<span style="color:#666">-</span>glfw<span style="color:#666">-</span>3.<span style="color:#b44">3</span>.<span style="color:#b44">1</span>.<span style="color:#b44">jar</span>:<span style="color:#666">?]</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>at<span style="color:#bbb"> </span>org.<span style="color:#b44">lwjgl</span>.<span style="color:#b44">system</span>.<span style="color:#b44">JNI</span>.<span style="color:#b44">invokeV</span>(Native<span style="color:#bbb"> </span>Method)<span style="color:#bbb"> </span><span style="color:#666">~[</span>lwjgl<span style="color:#666">-</span>3.<span style="color:#b44">3</span>.<span style="color:#b44">1</span>.<span style="color:#b44">jar</span>:<span style="color:#666">?]</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>at<span style="color:#bbb"> </span>org.<span style="color:#b44">lwjgl</span>.<span style="color:#b44">glfw</span>.<span style="color:#b44">GLFW</span>.<span style="color:#b44">glfwWaitEventsTimeout</span>(GLFW.<span style="color:#b44">java</span>:3474)<span style="color:#bbb"> </span><span style="color:#666">~[</span>lwjgl<span style="color:#666">-</span>glfw<span style="color:#666">-</span>3.<span style="color:#b44">3</span>.<span style="color:#b44">1</span>.<span style="color:#b44">jar</span>:<span style="color:#666">?]</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>at<span style="color:#bbb"> </span>com.<span style="color:#b44">mojang</span>.<span style="color:#b44">blaze3d</span>.<span style="color:#b44">systems</span>.<span style="color:#b44">RenderSystem</span>.<span style="color:#b44">limitDisplayFPS</span>(RenderSystem.<span style="color:#b44">java</span>:237)<span style="color:#bbb"> </span><span style="color:#666">~[</span>client<span style="color:#666">-</span>intermediary.<span style="color:#b44">jar</span>:<span style="color:#666">?]</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>at<span style="color:#bbb"> </span>net.<span style="color:#b44">minecraft</span>.<span style="color:#b44">class_310</span>.<span style="color:#b44">method_1523</span>(class_310.<span style="color:#b44">java</span>:1244)<span style="color:#bbb"> </span><span style="color:#666">~[</span>client<span style="color:#666">-</span>intermediary.<span style="color:#b44">jar</span>:<span style="color:#666">?]</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>at<span style="color:#bbb"> </span>net.<span style="color:#b44">minecraft</span>.<span style="color:#b44">class_310</span>.<span style="color:#b44">method_1514</span>(class_310.<span style="color:#b44">java</span>:802)<span style="color:#bbb"> </span><span style="color:#666">~[</span>client<span style="color:#666">-</span>intermediary.<span style="color:#b44">jar</span>:<span style="color:#666">?]</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>at<span style="color:#bbb"> </span>net.<span style="color:#b44">minecraft</span>.<span style="color:#b44">client</span>.<span style="color:#b44">main</span>.<span style="color:#b44">Main</span>.<span style="color:#b44">main</span>(Main.<span style="color:#b44">java</span>:250)<span style="color:#bbb"> </span><span style="color:#666">~[</span>minecraft<span style="color:#666">-</span>1.<span style="color:#b44">20</span>.<span style="color:#b44">1</span><span style="color:#666">-</span>client.<span style="color:#b44">jar</span>:<span style="color:#666">?]</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>at<span style="color:#bbb"> </span>net.<span style="color:#b44">fabricmc</span>.<span style="color:#b44">loader</span>.<span style="color:#b44">impl</span>.<span style="color:#b44">game</span>.<span style="color:#b44">minecraft</span>.<span style="color:#b44">MinecraftGameProvider</span>.<span style="color:#b44">launch</span>(MinecraftGameProvider.<span style="color:#b44">java</span>:468)<span style="color:#bbb"> </span><span style="color:#666">~[</span>fabric<span style="color:#666">-</span>loader<span style="color:#666">-</span>0.<span style="color:#b44">14</span>.<span style="color:#b44">21</span>.<span style="color:#b44">jar</span>:<span style="color:#666">?]</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>at<span style="color:#bbb"> </span>net.<span style="color:#b44">fabricmc</span>.<span style="color:#b44">loader</span>.<span style="color:#b44">impl</span>.<span style="color:#b44">launch</span>.<span style="color:#b44">knot</span>.<span style="color:#b44">Knot</span>.<span style="color:#b44">launch</span>(Knot.<span style="color:#b44">java</span>:74)<span style="color:#bbb"> </span><span style="color:#666">~[</span>fabric<span style="color:#666">-</span>loader<span style="color:#666">-</span>0.<span style="color:#b44">14</span>.<span style="color:#b44">21</span>.<span style="color:#b44">jar</span>:<span style="color:#666">?]</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>at<span style="color:#bbb"> </span>net.<span style="color:#b44">fabricmc</span>.<span style="color:#b44">loader</span>.<span style="color:#b44">impl</span>.<span style="color:#b44">launch</span>.<span style="color:#b44">knot</span>.<span style="color:#b44">KnotClient</span>.<span style="color:#b44">main</span>(KnotClient.<span style="color:#b44">java</span>:23)<span style="color:#bbb"> </span><span style="color:#666">~[</span>fabric<span style="color:#666">-</span>loader<span style="color:#666">-</span>0.<span style="color:#b44">14</span>.<span style="color:#b44">21</span>.<span style="color:#b44">jar</span>:<span style="color:#666">?]</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>at<span style="color:#bbb"> </span>org.<span style="color:#b44">prismlauncher</span>.<span style="color:#b44">launcher</span>.<span style="color:#b44">impl</span>.<span style="color:#b44">StandardLauncher</span>.<span style="color:#b44">launch</span>(StandardLauncher.<span style="color:#b44">java</span>:88)<span style="color:#bbb"> </span><span style="color:#666">~[</span>NewLaunch.<span style="color:#b44">jar</span>:<span style="color:#666">?]</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>at<span style="color:#bbb"> </span>org.<span style="color:#b44">prismlauncher</span>.<span style="color:#b44">EntryPoint</span>.<span style="color:#b44">listen</span>(EntryPoint.<span style="color:#b44">java</span>:126)<span style="color:#bbb"> </span><span style="color:#666">~[</span>NewLaunch.<span style="color:#b44">jar</span>:<span style="color:#666">?]</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>at<span style="color:#bbb"> </span>org.<span style="color:#b44">prismlauncher</span>.<span style="color:#b44">EntryPoint</span>.<span style="color:#b44">main</span>(EntryPoint.<span style="color:#b44">java</span>:71)<span style="color:#bbb"> </span><span style="color:#666">~[</span>NewLaunch.<span style="color:#b44">jar</span>:<span style="color:#666">?]</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>Caused<span style="color:#bbb"> </span>by:<span style="color:#bbb"> </span>java.<span style="color:#b44">io</span>.<span style="color:#b44">IOException</span>:<span style="color:#bbb"> </span>Cannot<span style="color:#bbb"> </span>run<span style="color:#bbb"> </span>program<span style="color:#bbb"> </span><span style="color:#b44">&#34;xdg-open&#34;</span>:<span style="color:#bbb"> </span>error<span style="color:#666">=</span>13,<span style="color:#bbb"> </span>权限不够<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>at<span style="color:#bbb"> </span>java.<span style="color:#b44">lang</span>.<span style="color:#b44">ProcessBuilder</span>.<span style="color:#b44">start</span>(ProcessBuilder.<span style="color:#b44">java</span>:1143)<span style="color:#bbb"> </span><span style="color:#666">~[?</span>:<span style="color:#666">?]</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>at<span style="color:#bbb"> </span>java.<span style="color:#b44">lang</span>.<span style="color:#b44">ProcessBuilder</span>.<span style="color:#b44">start</span>(ProcessBuilder.<span style="color:#b44">java</span>:1073)<span style="color:#bbb"> </span><span style="color:#666">~[?</span>:<span style="color:#666">?]</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>at<span style="color:#bbb"> </span>java.<span style="color:#b44">lang</span>.<span style="color:#b44">Runtime</span>.<span style="color:#b44">exec</span>(Runtime.<span style="color:#b44">java</span>:594)<span style="color:#bbb"> </span><span style="color:#666">~[?</span>:<span style="color:#666">?]</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>at<span style="color:#bbb"> </span>java.<span style="color:#b44">lang</span>.<span style="color:#b44">Runtime</span>.<span style="color:#b44">exec</span>(Runtime.<span style="color:#b44">java</span>:453)<span style="color:#bbb"> </span><span style="color:#666">~[?</span>:<span style="color:#666">?]</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>at<span style="color:#bbb"> </span>net.<span style="color:#b44">minecraft</span>.<span style="color:#b44">class_156$class_158</span>.<span style="color:#b44">method_671</span>(class_156.<span style="color:#b44">java</span>:313)<span style="color:#bbb"> </span><span style="color:#666">~[</span>client<span style="color:#666">-</span>intermediary.<span style="color:#b44">jar</span>:<span style="color:#666">?]</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>at<span style="color:#bbb"> </span>java.<span style="color:#b44">security</span>.<span style="color:#b44">AccessController</span>.<span style="color:#b44">doPrivileged</span>(AccessController.<span style="color:#b44">java</span>:569)<span style="color:#bbb"> </span><span style="color:#666">~[?</span>:<span style="color:#666">?]</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>...<span style="color:#bbb"> </span>27<span style="color:#bbb"> </span>more<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>Caused<span style="color:#bbb"> </span>by:<span style="color:#bbb"> </span>java.<span style="color:#b44">io</span>.<span style="color:#b44">IOException</span>:<span style="color:#bbb"> </span>error<span style="color:#666">=</span>13,<span style="color:#bbb"> </span>权限不够<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>at<span style="color:#bbb"> </span>java.<span style="color:#b44">lang</span>.<span style="color:#b44">ProcessImpl</span>.<span style="color:#b44">forkAndExec</span>(Native<span style="color:#bbb"> </span>Method)<span style="color:#bbb"> </span><span style="color:#666">~[?</span>:<span style="color:#666">?]</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>at<span style="color:#bbb"> </span>java.<span style="color:#b44">lang</span>.<span style="color:#b44">ProcessImpl</span>.<span style="color:#666">&lt;</span>init<span style="color:#666">&gt;</span>(ProcessImpl.<span style="color:#b44">java</span>:314)<span style="color:#bbb"> </span><span style="color:#666">~[?</span>:<span style="color:#666">?]</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>at<span style="color:#bbb"> </span>java.<span style="color:#b44">lang</span>.<span style="color:#b44">ProcessImpl</span>.<span style="color:#b44">start</span>(ProcessImpl.<span style="color:#b44">java</span>:244)<span style="color:#bbb"> </span><span style="color:#666">~[?</span>:<span style="color:#666">?]</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>at<span style="color:#bbb"> </span>java.<span style="color:#b44">lang</span>.<span style="color:#b44">ProcessBuilder</span>.<span style="color:#b44">start</span>(ProcessBuilder.<span style="color:#b44">java</span>:1110)<span style="color:#bbb"> </span><span style="color:#666">~[?</span>:<span style="color:#666">?]</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>at<span style="color:#bbb"> </span>java.<span style="color:#b44">lang</span>.<span style="color:#b44">ProcessBuilder</span>.<span style="color:#b44">start</span>(ProcessBuilder.<span style="color:#b44">java</span>:1073)<span style="color:#bbb"> </span><span style="color:#666">~[?</span>:<span style="color:#666">?]</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>at<span style="color:#bbb"> </span>java.<span style="color:#b44">lang</span>.<span style="color:#b44">Runtime</span>.<span style="color:#b44">exec</span>(Runtime.<span style="color:#b44">java</span>:594)<span style="color:#bbb"> </span><span style="color:#666">~[?</span>:<span style="color:#666">?]</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>at<span style="color:#bbb"> </span>java.<span style="color:#b44">lang</span>.<span style="color:#b44">Runtime</span>.<span style="color:#b44">exec</span>(Runtime.<span style="color:#b44">java</span>:453)<span style="color:#bbb"> </span><span style="color:#666">~[?</span>:<span style="color:#666">?]</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>at<span style="color:#bbb"> </span>net.<span style="color:#b44">minecraft</span>.<span style="color:#b44">class_156$class_158</span>.<span style="color:#b44">method_671</span>(class_156.<span style="color:#b44">java</span>:313)<span style="color:#bbb"> </span><span style="color:#666">~[</span>client<span style="color:#666">-</span>intermediary.<span style="color:#b44">jar</span>:<span style="color:#666">?]</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>at<span style="color:#bbb"> </span>java.<span style="color:#b44">security</span>.<span style="color:#b44">AccessController</span>.<span style="color:#b44">doPrivileged</span>(AccessController.<span style="color:#b44">java</span>:569)<span style="color:#bbb"> </span><span style="color:#666">~[?</span>:<span style="color:#666">?]</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>...<span style="color:#bbb"> </span>27<span style="color:#bbb"> </span>more<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>我写 java ，我也用 process builder 调用过，但问题是这问题是怎么会权限不够的。查了一下 java 的进程，归属于我的账户下，而且 jdk 在家目录，按理讲权限是足够的，而且 <code>xdg-open</code> 本身不是 <code>/sbin</code> 下的脚本。于是决定写个 Demo 验证下问题。</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="">#</span><span style="color:#bbb"> </span>OpenURL.<span style="color:#b44">java</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">import</span><span style="color:#bbb"> </span><span style="color:#00f;font-weight:bold">java.io.IOException</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">class</span> <span style="color:#00f">OpenURL</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">static</span><span style="color:#bbb"> </span><span style="color:#0b0;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#00a000">main</span>(String<span style="color:#666">[]</span><span style="color:#bbb"> </span>args)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>String<span style="color:#bbb"> </span>url<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span><span style="color:#b44">&#34;file:/home/ddqi/&#34;</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#a2f;font-weight:bold">try</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>ProcessBuilder<span style="color:#bbb"> </span>processBuilder<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">new</span><span style="color:#bbb"> </span>ProcessBuilder(<span style="color:#b44">&#34;xdg-open&#34;</span>,<span style="color:#bbb"> </span>url);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>Process<span style="color:#bbb"> </span>process<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span>processBuilder.<span style="color:#b44">start</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#0b0;font-weight:bold">int</span><span style="color:#bbb"> </span>exitCode<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span>process.<span style="color:#b44">waitFor</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#a2f;font-weight:bold">if</span><span style="color:#bbb"> </span>(exitCode<span style="color:#bbb"> </span><span style="color:#666">==</span><span style="color:#bbb"> </span>0)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span>System.<span style="color:#b44">out</span>.<span style="color:#b44">println</span>(<span style="color:#b44">&#34;成功打开URL: &#34;</span><span style="color:#bbb"> </span><span style="color:#666">+</span><span style="color:#bbb"> </span>url);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>}<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">else</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span>System.<span style="color:#b44">err</span>.<span style="color:#b44">println</span>(<span style="color:#b44">&#34;无法打开URL: &#34;</span><span style="color:#bbb"> </span><span style="color:#666">+</span><span style="color:#bbb"> </span>url);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>}<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">catch</span><span style="color:#bbb"> </span>(IOException<span style="color:#bbb"> </span><span style="color:#666">|</span><span style="color:#bbb"> </span>InterruptedException<span style="color:#bbb"> </span>e)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>e.<span style="color:#b44">printStackTrace</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>测试MA</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># MANIFEST.MF
</span></span><span style="display:flex;"><span>Manifest-Version: 1.0
</span></span><span style="display:flex;"><span>Main-Class: OpenURL
</span></span></code></pre></td></tr></table>
</div>
</div><p>然后用 jdk17 编译打包一下：</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>javac OpenURL.java
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>jar -cfm OpenURL.jar MANIFEST.MF OpenURL.class
</span></span></code></pre></td></tr></table>
</div>
</div><p>运行：</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>java -jar OpenURL.jar
</span></span></code></pre></td></tr></table>
</div>
</div><p>很明显的一个问题，报错和 MC 的报错一致。说明可能不是代码的问题。思路转变一下，CentOS 上我被 SELinux 恶心过，但是还有个东西是其他发行版上用的，Apparmor，也是内核级别的，我打自己的内核时候都是去掉支持的。那么没办法，先至少关掉 Apparmor 试一下，添加内核参数，重启，然后 <code>aa-status</code> 一下，确认关闭。重新运行一次该 jar 文件，得到成功响应但是却无法拉起 dolphin 的问题。那估计只能是 jdk 少东西了或者依赖什么少了&hellip;</p>
<p>于是开始重复：改 Apparmor 规则，跑 demo 验证。但是连最开始没出现问题的 jdk8 在 demo 中行为也不正常。按理来讲 Apparmor 启用时候至少 jdk8 行为在 In-Game 中是正常的，java17 的可能是撞了 java 自己的安全策略。但是这样的话又解释不清同一套 jdk 为什么在 Arch 上就行为正常。（这里定义正常行为为未开启任何策略下，java process builder 能够掉用其他 os 的套件拉起进程）</p>
<h2 id="debian---arch-linux">Debian -&gt; Arch LInux</h2>
<p>正常情况下发现问题，分析问题，解决问题对于正常人来说是一个正常的流程。但是这是一个 不正常的问题，我的怒气值已经满了，以及我最低的要求都满足不了我要你干甚。惹不起老子躲不起吗，走走走打道回府。</p>
<p>安装回去的流程更简单，本身 squashfs 就是根分区的最小完整克隆。释放回去就完事了。步骤还是轻车熟路：下 live CD，写盘，重启。</p>
<p>直接格调这个折磨我心态到爆炸的 Debian :</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#080;font-style:italic"># -f 强制重做文件系统</span>
</span></span><span style="display:flex;"><span>mkfs.btrfs -f /dev/nvme1n1p2
</span></span></code></pre></td></tr></table>
</div>
</div><p>然后把外接 SSD 挂上来看看原来的 <code>fstab</code> 怎么写：</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>mkdir -p {test,test1}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mount  /dev/sda1 ./test
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mount  ./test/backup-archlinux.squashfs ./test1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cat ./test1/etc/fstab
</span></span></code></pre></td></tr></table>
</div>
</div><p>分区布局是这样的：</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#080;font-style:italic"># /dev/nvme1n1p2</span>
</span></span><span style="display:flex;"><span><span style="color:#b8860b">UUID</span><span style="color:#666">=</span>be72b201-80a6-4224-ba13-4bb6e0414577       /               btrfs           rw,relatime,compress<span style="color:#666">=</span>zstd:3,ssd,discard<span style="color:#666">=</span>async,space_cache<span style="color:#666">=</span>v2,subvolid<span style="color:#666">=</span>256,subvol<span style="color:#666">=</span>/@      <span style="color:#666">0</span> <span style="color:#666">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"># /dev/nvme1n1p2</span>
</span></span><span style="display:flex;"><span><span style="color:#b8860b">UUID</span><span style="color:#666">=</span>be72b201-80a6-4224-ba13-4bb6e0414577       /tmp            btrfs           rw,relatime,compress<span style="color:#666">=</span>zstd:3,ssd,discard<span style="color:#666">=</span>async,space_cache<span style="color:#666">=</span>v2,subvolid<span style="color:#666">=</span>257,subvol<span style="color:#666">=</span>/@tmp   <span style="color:#666">0</span> <span style="color:#666">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"># /dev/nvme1n1p2</span>
</span></span><span style="display:flex;"><span><span style="color:#b8860b">UUID</span><span style="color:#666">=</span>be72b201-80a6-4224-ba13-4bb6e0414577       /usr/local      btrfs           rw,relatime,compress<span style="color:#666">=</span>zstd:3,ssd,discard<span style="color:#666">=</span>async,space_cache<span style="color:#666">=</span>v2,subvolid<span style="color:#666">=</span>258,subvol<span style="color:#666">=</span>/@usr_local     <span style="color:#666">0</span> <span style="color:#666">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"># /dev/nvme1n1p2</span>
</span></span><span style="display:flex;"><span><span style="color:#b8860b">UUID</span><span style="color:#666">=</span>be72b201-80a6-4224-ba13-4bb6e0414577       /var/log        btrfs           rw,relatime,compress<span style="color:#666">=</span>zstd:3,ssd,discard<span style="color:#666">=</span>async,space_cache<span style="color:#666">=</span>v2,subvolid<span style="color:#666">=</span>259,subvol<span style="color:#666">=</span>/@var_log       <span style="color:#666">0</span> <span style="color:#666">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"># /dev/nvme0n1p1 LABEL=SYSTEM</span>
</span></span><span style="display:flex;"><span><span style="color:#b8860b">UUID</span><span style="color:#666">=</span>BE42-0216          /boot/efi       vfat            rw,relatime,fmask<span style="color:#666">=</span>0022,dmask<span style="color:#666">=</span>0022,codepage<span style="color:#666">=</span>437,iocharset<span style="color:#666">=</span>ascii,shortname<span style="color:#666">=</span>mixed,utf8,errors<span style="color:#666">=</span>remount-ro    <span style="color:#666">0</span> <span style="color:#666">2</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"># /dev/nvme1n1p3</span>
</span></span><span style="display:flex;"><span><span style="color:#b8860b">UUID</span><span style="color:#666">=</span>97ed42a1-e595-4009-81f0-470f9d183109       /home           ext4            rw,relatime     <span style="color:#666">0</span> <span style="color:#666">2</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"># /dev/nvme1n1p2</span>
</span></span><span style="display:flex;"><span><span style="color:#b8860b">UUID</span><span style="color:#666">=</span>be72b201-80a6-4224-ba13-4bb6e0414577       /.snapshots     btrfs           rw,relatime,compress<span style="color:#666">=</span>zstd:3,ssd,discard<span style="color:#666">=</span>async,space_cache<span style="color:#666">=</span>v2,subvolid<span style="color:#666">=</span>260,subvol<span style="color:#666">=</span>/@snapshots     <span style="color:#666">0</span> <span style="color:#666">0</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>那子卷布局还是按照原来的做：</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#080;font-style:italic"># 先把根挂上来,开启压缩（必须和打包前的分区inode保持一致）</span>
</span></span><span style="display:flex;"><span>mount -o <span style="color:#b8860b">compress</span><span style="color:#666">=</span>zstd /dev/nvme1n1p2 /mnt
</span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"># 根分区</span>
</span></span><span style="display:flex;"><span>btrfs subvolume create /mnt/@
</span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"># /tmp</span>
</span></span><span style="display:flex;"><span>btrfs subvolume create /mnt/@tmp
</span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"># /var/log</span>
</span></span><span style="display:flex;"><span>btrfs subvolume create /mnt/@var_log
</span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"># /usr/local</span>
</span></span><span style="display:flex;"><span>btrfs subvolume create /mnt/@usr_local
</span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"># /.snapshots</span>
</span></span><span style="display:flex;"><span>btrfs subvolume create /mnt/@snapshots
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"># 卸载根分区</span>
</span></span><span style="display:flex;"><span>umount /mnt
</span></span></code></pre></td></tr></table>
</div>
</div><p>接着直接挂分区：</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#080;font-style:italic"># 根分区和子卷</span>
</span></span><span style="display:flex;"><span>mount -o <span style="color:#b8860b">compress</span><span style="color:#666">=</span>zstd,subvol<span style="color:#666">=</span>@ /dev/nvme1n1p2 /mnt
</span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"># 创建挂载点</span>
</span></span><span style="display:flex;"><span>mkdir -p /mnt/<span style="color:#666">{</span>home.usr/local,proc.run,sys,media,dev,var/log,tmp,.snapshots,boot/efi<span style="color:#666">}</span>
</span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"># 挂载其他子卷</span>
</span></span><span style="display:flex;"><span>mount -o <span style="color:#b8860b">compress</span><span style="color:#666">=</span>zstd,subvol<span style="color:#666">=</span>@tmp /dev/nvme1n1p2 /mnt/tmp
</span></span><span style="display:flex;"><span>mount -o <span style="color:#b8860b">compress</span><span style="color:#666">=</span>zstd,subvol<span style="color:#666">=</span>@var_log /dev/nvme1n1p2 /mnt/var/log
</span></span><span style="display:flex;"><span>mount -o <span style="color:#b8860b">compress</span><span style="color:#666">=</span>zstd,subvol<span style="color:#666">=</span>@usr_local /dev/nvme1n1p2 /mnt/usr/local
</span></span><span style="display:flex;"><span>mount -o <span style="color:#b8860b">compress</span><span style="color:#666">=</span>zstd,subvol<span style="color:#666">=</span>@snapshots /dev/nvme1n1p2 /mnt/.snapshots
</span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"># efi 和 home</span>
</span></span><span style="display:flex;"><span>mount /dev/nvme0n1p1 /mnt/boot/efi
</span></span><span style="display:flex;"><span>mount /dev/nvme1n1p3 /mnt/home
</span></span></code></pre></td></tr></table>
</div>
</div><p>释放镜像：</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#080;font-style:italic"># 取消挂载镜像</span>
</span></span><span style="display:flex;"><span>umount ./test1
</span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"># 释放镜像</span>
</span></span><span style="display:flex;"><span>unsquashfs -f -d /mnt test/backup-archlinux.squashfs
</span></span></code></pre></td></tr></table>
</div>
</div><p>完成后基本就没什么问题了，但是需要重新装一下 grub：</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#080;font-style:italic"># chroot 到系统</span>
</span></span><span style="display:flex;"><span>arch-chroot /mnt
</span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"># 删除旧的 grub 引导</span>
</span></span><span style="display:flex;"><span>rm -rf /boot/efi/EFI/Debian
</span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"># 装载引导器</span>
</span></span><span style="display:flex;"><span>grub-install --target<span style="color:#666">=</span>x86_64-efi --efi-directory<span style="color:#666">=</span>/boot/efi/ --recheck
</span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"># 生成配置</span>
</span></span><span style="display:flex;"><span>grub-mkconfig -o /boot/grub/grub.cfg
</span></span></code></pre></td></tr></table>
</div>
</div><p>由于根分区 UUID 变了，因为 fstab 还是得改一下，直接退出  chroot 环境，执行：</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>genfstab -U /mnt &gt;&gt; /mnt/etc/fstab
</span></span></code></pre></td></tr></table>
</div>
</div><p>重启一下发现又回到和蔼可亲的 Arch Linux 了。</p>
<h2 id="总结">总结</h2>
<p>先排除自己的菜的原因。我可能菜，但是桌面系统用的如此憋屈感觉应该不全是我的问题&hellip;每次想从 Arch 叛逃，但是又逃回来，每次都是走之前觉得 Arch 这不好那不好骗自己能有办法安心在新发行版下熟悉，但是用着用着却又想起之前的各个好处。尤其是有 aur 这样的整合的，统一的平台这件事。省去了很多麻烦，也方便统一管理。</p>
<p>但是话又说回来，现在的自己竟然这么习惯于逃避了&hellip;果然是因为害怕的事情变多了的缘故么。</p>
    </div>
    
    <div>
      <ul class="post-copyright">
        <li class="post-copyright-author"><strong>本文作者: </strong>weearc</li>
        <li class="post-copyright-link"><strong>本文链接: </strong><a title="https://blog.weearc.top/posts/2866972811/" href="https://blog.weearc.top/posts/2866972811/">https://blog.weearc.top/posts/2866972811/</a></li>
        <li class="post-copyright-license"><strong>版权声明: </strong>除特殊声明，转载需遵循 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a></li>
      </ul>
    </div>
    
    <div class="tags">
      
        <a href="/tags/archlinux">archlinux</a>
      
        <a href="/tags/%e7%b3%bb%e7%bb%9f%e8%bf%81%e7%a7%bb">系统迁移</a>
      
        <a href="/tags/debian">debian</a>
      
        <a href="/tags/btrfs">btrfs</a>
      
        <a href="/tags/%e7%b3%bb%e7%bb%9f%e5%a4%87%e4%bb%bd">系统备份</a>
      
    </div>
    
    <div class="post-nav">
      
        <a class="pre" href="/posts/2817549702/" title="记从 HEXO 迁移到 Hugo 安家之旅">记从 HEXO 迁移到 Hugo 安家之旅</a>
      
      
        <a class="next" href="/posts/2197/" title="测试页">测试页</a>
      
    </div>
    
    
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
<div id="vcomments" class=" v" data-class="v"></div>
<script>
    function loadComments() {
        
        new Valine({
            el: '#vcomments',
            appId: 'bhQyg8BFhAianSbFIDztqY5F-gzGzoHsz',
            appKey: 'hyBnHdPlTNOtclNbq8oB5bwg',
            placeholder: 'Just so so',
            notify: 'true',
            verify: 'true',
            path: '\/posts\/2866972811\/',
            avatar: '',
            meta: '',
            pageSize: '',
            lang: '',
            visitor: '',
            highlight: '',
            avatarForce: '',
            recordIP: ''
        });
    }
    if (window.location.pathname !== '/about/' && window.location.pathname !== '/frlink/') {
        loadComments()
    }
</script>
    

  </div>

        </div>
      </div>
      
      <div class="pure-u-1-4 hidden_mid_and_down">
        <div id="sidebar">
    
<div class="widget">
    <div class="search-form">
        <input id="local-search-input" placeholder="搜索" type="text" name="q" results="0">
        <div id="local-search-result"></div>
    </div>
</div>

    <div class="widget">
    <div class="widget__title">
        <i class="fa fa-folder-o">分类</i>
    </div>
    <ul class="category-list">
        
            <li class="category-list__item">
                <a class="category-list__link" href="https://blog.weearc.top/categories/android/">
                    Android
                </a>
            </li>
        
            <li class="category-list__item">
                <a class="category-list__link" href="https://blog.weearc.top/categories/archlinux/">
                    Archlinux
                </a>
            </li>
        
            <li class="category-list__item">
                <a class="category-list__link" href="https://blog.weearc.top/categories/blog/">
                    Blog
                </a>
            </li>
        
            <li class="category-list__item">
                <a class="category-list__link" href="https://blog.weearc.top/categories/hello-hexo/">
                    Hello Hexo
                </a>
            </li>
        
            <li class="category-list__item">
                <a class="category-list__link" href="https://blog.weearc.top/categories/hexo/">
                    Hexo
                </a>
            </li>
        
            <li class="category-list__item">
                <a class="category-list__link" href="https://blog.weearc.top/categories/hugo/">
                    Hugo
                </a>
            </li>
        
            <li class="category-list__item">
                <a class="category-list__link" href="https://blog.weearc.top/categories/kde/">
                    Kde
                </a>
            </li>
        
            <li class="category-list__item">
                <a class="category-list__link" href="https://blog.weearc.top/categories/minecraft/">
                    Minecraft
                </a>
            </li>
        
            <li class="category-list__item">
                <a class="category-list__link" href="https://blog.weearc.top/categories/php/">
                    Php
                </a>
            </li>
        
            <li class="category-list__item">
                <a class="category-list__link" href="https://blog.weearc.top/categories/tools/">
                    Tools
                </a>
            </li>
        
            <li class="category-list__item">
                <a class="category-list__link" href="https://blog.weearc.top/categories/%E4%B8%80%E8%A8%80/">
                    一言
                </a>
            </li>
        
            <li class="category-list__item">
                <a class="category-list__link" href="https://blog.weearc.top/categories/%E5%89%8D%E7%AB%AF/">
                    前端
                </a>
            </li>
        
            <li class="category-list__item">
                <a class="category-list__link" href="https://blog.weearc.top/categories/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E5%85%B3/">
                    博客相关
                </a>
            </li>
        
            <li class="category-list__item">
                <a class="category-list__link" href="https://blog.weearc.top/categories/%E5%8D%9A%E5%AE%A2%E9%85%8D%E5%A5%97/">
                    博客配套
                </a>
            </li>
        
            <li class="category-list__item">
                <a class="category-list__link" href="https://blog.weearc.top/categories/%E5%AE%9E%E7%94%A8%E5%B7%A5%E5%85%B7/">
                    实用工具
                </a>
            </li>
        
            <li class="category-list__item">
                <a class="category-list__link" href="https://blog.weearc.top/categories/%E5%BE%85%E4%BF%AE%E6%94%B9/">
                    待修改
                </a>
            </li>
        
            <li class="category-list__item">
                <a class="category-list__link" href="https://blog.weearc.top/categories/%E5%BE%85%E5%A1%AB%E5%9D%91/">
                    待填坑
                </a>
            </li>
        
            <li class="category-list__item">
                <a class="category-list__link" href="https://blog.weearc.top/categories/%E6%9D%82%E8%AE%B0/">
                    杂记
                </a>
            </li>
        
            <li class="category-list__item">
                <a class="category-list__link" href="https://blog.weearc.top/categories/%E6%9D%82%E8%B0%88/">
                    杂谈
                </a>
            </li>
        
            <li class="category-list__item">
                <a class="category-list__link" href="https://blog.weearc.top/categories/%E6%B5%8B%E8%AF%95/">
                    测试
                </a>
            </li>
        
            <li class="category-list__item">
                <a class="category-list__link" href="https://blog.weearc.top/categories/%E7%8E%A9%E8%B5%8F/">
                    玩赏
                </a>
            </li>
        
            <li class="category-list__item">
                <a class="category-list__link" href="https://blog.weearc.top/categories/%E8%BD%AC%E8%BD%BD%E7%B2%BE%E5%93%81/">
                    转载精品
                </a>
            </li>
        
            <li class="category-list__item">
                <a class="category-list__link" href="https://blog.weearc.top/categories/%E8%BE%93%E5%85%A5%E6%B3%95/">
                    输入法
                </a>
            </li>
        
            <li class="category-list__item">
                <a class="category-list__link" href="https://blog.weearc.top/categories/%E9%9A%8F%E7%AC%94/">
                    随笔
                </a>
            </li>
        
    </ul>
</div>

    <div class="widget">
    <div class="widget__title">
        <i class="fa fa-tag">
            标签
        </i>
    </div>
    <div class="tagcloud">
        
            <a href="https://blog.weearc.top/tags/android/">android</a>
        
            <a href="https://blog.weearc.top/tags/archlinux/">archlinux</a>
        
            <a href="https://blog.weearc.top/tags/blog/">blog</a>
        
            <a href="https://blog.weearc.top/tags/btrfs/">btrfs</a>
        
            <a href="https://blog.weearc.top/tags/debian/">debian</a>
        
            <a href="https://blog.weearc.top/tags/fcitx/">fcitx</a>
        
            <a href="https://blog.weearc.top/tags/fcitx5/">fcitx5</a>
        
            <a href="https://blog.weearc.top/tags/firefox/">firefox</a>
        
            <a href="https://blog.weearc.top/tags/firefox-nightly/">firefox-nightly</a>
        
            <a href="https://blog.weearc.top/tags/fish-shell/">fish shell</a>
        
            <a href="https://blog.weearc.top/tags/github-actions/">github actions</a>
        
            <a href="https://blog.weearc.top/tags/github-webhook/">github webhook</a>
        
            <a href="https://blog.weearc.top/tags/hello-word/">hello-word</a>
        
            <a href="https://blog.weearc.top/tags/hexo/">hexo</a>
        
            <a href="https://blog.weearc.top/tags/history-file/">history file</a>
        
            <a href="https://blog.weearc.top/tags/hugo/">hugo</a>
        
            <a href="https://blog.weearc.top/tags/js/">js</a>
        
            <a href="https://blog.weearc.top/tags/linux/">linux</a>
        
            <a href="https://blog.weearc.top/tags/manjaro/">manjaro</a>
        
            <a href="https://blog.weearc.top/tags/markdown/">markdown</a>
        
            <a href="https://blog.weearc.top/tags/minecraft/">minecraft</a>
        
            <a href="https://blog.weearc.top/tags/pandoc/">pandoc</a>
        
            <a href="https://blog.weearc.top/tags/php/">php</a>
        
            <a href="https://blog.weearc.top/tags/redmi/">redmi</a>
        
            <a href="https://blog.weearc.top/tags/ubuntu/">ubuntu</a>
        
            <a href="https://blog.weearc.top/tags/xclip/">xclip</a>
        
            <a href="https://blog.weearc.top/tags/zenity/">zenity</a>
        
            <a href="https://blog.weearc.top/tags/zotero/">zotero</a>
        
            <a href="https://blog.weearc.top/tags/%E4%B8%80%E7%99%BE%E7%AF%87%E5%8D%9A%E6%96%87/">一百篇博文</a>
        
            <a href="https://blog.weearc.top/tags/%E4%B8%80%E8%A8%80/">一言</a>
        
            <a href="https://blog.weearc.top/tags/%E5%89%8D%E7%AB%AF/">前端</a>
        
            <a href="https://blog.weearc.top/tags/%E5%8D%87%E7%BA%A7/">升级</a>
        
            <a href="https://blog.weearc.top/tags/%E5%8D%9A%E5%AE%A2/">博客</a>
        
            <a href="https://blog.weearc.top/tags/%E5%8E%BB%E4%BB%96%E5%A6%88%E7%9A%84%E7%BD%91%E6%98%93%E4%BA%91/">去他妈的网易云</a>
        
            <a href="https://blog.weearc.top/tags/%E5%93%8D%E5%BA%94%E5%BC%8F/">响应式</a>
        
            <a href="https://blog.weearc.top/tags/%E5%AE%8C%E5%85%A8%E9%85%8D%E7%BD%AE/">完全配置</a>
        
            <a href="https://blog.weearc.top/tags/%E5%B0%8F%E7%B1%B3/">小米</a>
        
            <a href="https://blog.weearc.top/tags/%E5%BE%85%E4%BF%AE%E6%94%B9/">待修改</a>
        
            <a href="https://blog.weearc.top/tags/%E6%95%99%E7%A8%8B/">教程</a>
        
            <a href="https://blog.weearc.top/tags/%E6%9C%A8%E4%B8%8B%E3%82%86%E3%81%86%E3%81%8B/">木下ゆうか</a>
        
            <a href="https://blog.weearc.top/tags/%E6%9C%A8%E4%B8%8B%E4%BD%91%E9%A6%99/">木下佑香</a>
        
            <a href="https://blog.weearc.top/tags/%E6%9D%82%E8%AE%B0/">杂记</a>
        
            <a href="https://blog.weearc.top/tags/%E6%9D%82%E8%B0%88/">杂谈</a>
        
            <a href="https://blog.weearc.top/tags/%E6%9D%82%E9%A1%B9/">杂项</a>
        
            <a href="https://blog.weearc.top/tags/%E6%A8%A1%E7%89%88/">模版</a>
        
            <a href="https://blog.weearc.top/tags/%E6%AF%95%E4%B8%9A%E5%AD%A3/">毕业季</a>
        
            <a href="https://blog.weearc.top/tags/%E7%94%9F%E5%AD%98%E8%AE%B0%E5%BD%95/">生存记录</a>
        
            <a href="https://blog.weearc.top/tags/%E7%94%B5%E9%87%8F%E7%84%A6%E8%99%91/">电量焦虑</a>
        
            <a href="https://blog.weearc.top/tags/%E7%9F%A5%E4%B9%8E/">知乎</a>
        
            <a href="https://blog.weearc.top/tags/%E7%B3%BB%E7%BB%9F%E5%A4%87%E4%BB%BD/">系统备份</a>
        
            <a href="https://blog.weearc.top/tags/%E7%B3%BB%E7%BB%9F%E8%BF%81%E7%A7%BB/">系统迁移</a>
        
            <a href="https://blog.weearc.top/tags/%E7%BA%A2%E7%B1%B3-k30-pro/">红米 k30 pro</a>
        
            <a href="https://blog.weearc.top/tags/%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2/">自动化部署</a>
        
            <a href="https://blog.weearc.top/tags/%E8%AF%81%E6%82%9F/">证悟</a>
        
            <a href="https://blog.weearc.top/tags/%E8%B7%AF%E7%94%B1%E5%99%A8/">路由器</a>
        
            <a href="https://blog.weearc.top/tags/%E8%BD%AC%E8%BD%BD%E6%96%87%E7%AB%A0/">转载文章</a>
        
            <a href="https://blog.weearc.top/tags/%E9%9A%8F%E7%AC%94/">随笔</a>
        
            <a href="https://blog.weearc.top/tags/%E9%A3%9F%E8%B0%B1/">食谱</a>
        
    </div>
</div>

</div>


      </div>
      
      <div class="pure-u-1  pure-u-md-3-4 ">
        
    <footer id="footer">
            <span>Copyright &copy; 2024 | <i class="fa fa-moon-o"></i><a href="https://blog.weearc.top/">weearc 的个人博客</a></span></br>
        <span>
            Powered by
            <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> | Theme by
            <a href="https://github.com/weearc" rel="noopener" target="_blank">weearc</a>
        </span></br>
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        <i class="fa fa-eye"></i><span id="busuanzi_container_site_pv"> 总访问量 <span id="busuanzi_value_site_pv"></span> 次 </span> |
        <i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv"> 访客数 <span id="busuanzi_value_site_uv"></span> 人次 </span></br>
        <span>
            <a href="http://beian.miit.gov.cn/" rel="noopener" target="_blank" style="border:none;">
                辽ICP备2020011073号
            </a>
        </span>
    </footer>
    <script>
    var htmlCopyButton = `
    <div id="codeblock-titlebar">
        <span id="lang-title" style="font-size: 5px"></span>
        <button id="clipboard-btn" class="codecopy-btn tooltipped tooltipped-sw" aria-label="Copy to clipboard">
            <span id="clipboard-btn-icon" class="fa fa-copy" aria-hidden="true"></span>
            点击复制
        </button>
    </div>
    `;

    $('.highlight').each(function(index) {
        $(this).prepend(htmlCopyButton)
    });

    $('.codecopy-btn').click(function() {
        var parent = $(this).parent().parent();
        var title = $(this).parent();
        var siblingsNext = parent.children().not(title);
        var tbody = siblingsNext.find('table tbody');
        var td = tbody.find('tr:eq(0)').find('td:eq(1)');
        if ('clipboard' in navigator) {
            navigator.clipboard.writeText(td[0].textContent);

            this.innerHTML = `
            <span id="clipboard-btn-icon" class="fa fa-check" aria-hidden="true"></span>
            已复制！
            `;
            setTimeout(() => {
                this.innerHTML = `
                <span id="clipboard-btn-icon" class="fa fa-copy" aria-hidden="true"></span>
                点击复制
                `;
            }, 900);


            return;
        };
    });
</script>


      </div>
    </div>
  </div>
</body>
</html>
